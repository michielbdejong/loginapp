<script language="JavaScript" type="text/javascript" src="unhosted/prng4.js"></script>
<script language="JavaScript" type="text/javascript" src="unhosted/rng.js"></script>
<script language="JavaScript" type="text/javascript" src="unhosted/rijndael.js"></script>
<script language="JavaScript" type="text/javascript" src="unhosted/sha1.js"></script>
<script language="JavaScript" type="text/javascript" src="unhosted/jsbn.js"></script>
<script language="JavaScript" type="text/javascript" src="unhosted/unhosted.js"></script>
<script>
var args = {};
function getArgs() {
	var parts = document.location.href.split('?', 2);
	if(parts.length < 2) {
		return;
	}
	var argSpecs = parts[1].split('&');
	var argParts;
	for(i in argSpecs){
		argParts=argSpecs[i].split('=', 2);
		args[argParts[0]]=argParts[1];
	}
}
function processPopShake() {
	getArgs();
	if(typeof args['action'] != 'undefined' && args['action'] == 'takePopShake') {
		unhosted.takePopShake(args['guid'], args['token'], args['app']);
		window.location='http://lovepoems.org/';
	}
}
var loggedInGuid = undefined;
function showMyKey() {
	var key;
	if(typeof loggedInGuid != 'undefined') {
		key = unhosted.debugKey(loggedInGuid);
	}
	if(typeof key == 'undefined') {
		document.getElementById('keyDiv').innerHTML = 'Not logged in.';
	} else {
		document.getElementById('keyDiv').innerHTML = key
			+'<input type="button" value="logout" onclick="logout();" id="logoutButton"/>';
	}
}
function logout() {
	document.getElementById('logoutButton').disabled = true;
	unhosted.forgetKey(loggedInGuid);
	document.getElementById('logoutButton').disabled = false;
	showMyKey();
}
function loginWithWallet() {
	document.getElementById('loginButton').disabled = true;
	var guid = document.getElementById("login_guid").value;
	var pass = document.getElementById("login_pass").value;
	unhosted.importWallet(guid, 'grommace.com', pass);
	loggedInGuid = guid;
	showMyKey();
	document.getElementById('loginButton').disabled = false;
}
function showCaptcha() {
	document.getElementById('reg_captcha_img').src=unhosted.getCaptchaUrl('mynode.org', 'reg');
	showMyKey();
}
function register() {
	document.getElementById('registerButton').disabled = true;
	var guid = document.getElementById("reg_user").value+'@mynode.org';
	var pass = document.getElementById("reg_pass").value;
	var pass2 = document.getElementById("reg_pass2").value;
	var captchaSolution = document.getElementById("reg_captcha_solution").value;
	if(pass != pass2) {
		alert('passwords don\'t match');
	} else {
		unhosted.genkeyCaptcha(guid, 'reg', captchaSolution);
		unhosted.exportWallet(guid, 'grommace.com', pass);
	}
	loggedInGuid = guid;
	showMyKey();
	document.getElementById('registerButton').disabled = false;
}
function addWithPopShake() {
	document.getElementById('addButton').disabled = true;
	var guid = document.getElementById('add_guid').value;
	var existing_app = document.getElementById('add_app').value;
	var popShakeToken =unhosted.generatePopShakeToken();
	var popupUrl ="http://"+existing_app+"/PopShake/?app=lovepoems.org&token="+popShakeToken+"&guid="+guid;
	//window.open (popupUrl,"mywindow");
	window.location = popupUrl;
	//poll for "myWindow" to close...
	unhosted.takePopShake(guid, token, existing_app);
	//in there they login, the app sends a SHAKEPOPGIVE token
	document.getElementById('urlDiv').innerHTML=document.location;
	loggedInGuid = guid;
	showMyKey();
	document.getElementById('addButton').disabled = false;
}
</script>
<body onload="processPopShake();showCaptcha();" bgcolor="FFAAAA">
<div id="keyDiv">loading</div>
<table><tr><td><p>
<H2>Login:</H2>
<p><table border="1"><tr><td>
<input type="text" value="user@node.ext" id="login_guid"/><br/>
<input type="text" value="pwd" id="login_pass"/><br/>
<input type="button" value = 'login' onclick="loginWithWallet();" id="loginButton">
</td></tr></table>
</p></td><td><p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</p></td><td><p>
<H2>Register:</H2>
<p><table border="1"><tr><td>
<input type="text" value="user" id="reg_user"/>@mynode.org<br/>
<input type="text" value="pwd" id="reg_pass"/> repeat:
<input type="text" value="pwd" id="reg_pass2"/><br/>
<div id="captchaDiv" visibility=false>
<img src="" id="reg_captcha_img"/>
<input type="text" value="type what you see in the image" id="reg_captcha_solution"/><br/>
</div>
<input type="button" value = 'register' onclick="register();" id="registerButton"/><strong>this takes a few seconds when you click</strong>
</td></tr></table></p>
</td></tr></table>
looks like normal website so far, doesn't it? maybe you expect an OpenId option now? Well, lovepoems.org is unhosted, so unless your browser is allowed to open port 80 on a public IP, we can't OpenId you, but we do have used something similar. If you have used any unhosted web apps before:
<H2>Or add lovepoems.org to your unhosted storage:<a href="http://www.unhosted.org">what's this?</a></H2>
<p><table border="1"><tr><td>
Your email address:<input type="text" value="joe@bloggs.com" id="add_guid"/><br/>
Unhosted Web App to log in with:<input type="text" value="fastcars.org" id="add_app"/><br/>
<input type="button" value = 'add' onclick="addWithPopShake();" id="addButton"/>
</td></tr></table><br/>
</body>
</html>
